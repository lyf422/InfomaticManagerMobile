(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["iuc/roomApplication/v2/roomFlowsCtrl"],{"3bc7":function(t,e,i){"use strict";i.r(e);var n=i("e6123"),a=i("e294");for(var o in a)"default"!==o&&function(t){i.d(e,t,function(){return a[t]})}(o);i("db0e");var s,r=i("f0c5"),u=Object(r["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],s);e["default"]=u.exports},"464f":function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=a(i("a34a"));function a(t){return t&&t.__esModule?t:{default:t}}function o(t,e,i,n,a,o,s){try{var r=t[o](s),u=r.value}catch(c){return void i(c)}r.done?e(u):Promise.resolve(u).then(n,a)}function s(t){return function(){var e=this,i=arguments;return new Promise(function(n,a){var s=t.apply(e,i);function r(t){o(s,n,a,r,u,"next",t)}function u(t){o(s,n,a,r,u,"throw",t)}r(void 0)})}}function r(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},n=Object.keys(i);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),n.forEach(function(e){u(t,e,i[e])})}return t}function u(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var c={onLoad:function(e){var i=this;t.post("/api/roomApp/v1/GetRoomAndTeacher",{},function(t){i.assistInfo=r({},i.assistInfo,t);var e={};i.assistInfo.buildings.forEach(function(t){var i=t.Name;t.Rooms.forEach(function(t){e[t.ID]=i+"-"+t.RoomCode+"-"+t.Name})}),e["00000000-0000-0000-0000-000000000000"]="请选择房间号",i.roomDic=e}),e.create?(this.displayTimeline=!1,t.getStorage({key:"labid",success:function(e){var n=e.data;t.post("/api/roomApp/v1/Applicate",{id:n},function(e){if(i.io=e,e.success){for(var n in i.io.data.OwnerRoles)if("老师"===i.io.data.OwnerRoles[n]){i.isStudent=!1;break}}else t.showMessage(e.msg)})}})):t.getStorage({key:"jmpInfo",success:function(e){t.post("/api/workflow/LoadInstance",r({},e.data,{detail:!0}),function(e){if(e.success){for(var n in i.io=e,i.io.data.OwnerRoles)if("老师"===i.io.data.OwnerRoles[n]){i.isStudent=!1;break}if(5===i.io.intstanceState)for(var a in i.io.allSteps)if(0===i.io.allSteps[a].status){i.io.allSteps[a-1].status=30,i.io.timelines[0].steps[0].State=4;break}for(var o in i.io.data.OwnerRoles)if("老师"===i.io.data.OwnerRoles[o]){i.isStudent=!1;break}}else t.showMessage(e.msg)})}})},methods:{formValidate:function(){var e=s(n.default.mark(function e(i){var a,o,s,r;return n.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return a=[],this.isStudent&&"00000000-0000-0000-0000-000000000000"===this.io.data.GuideTeacherId&&"填写申请表"===this.io.currentStep&&a.push("必须选择指导老师"),void 0!==this.upLoad.Telephone&&"填写申请表"===this.io.currentStep&&(o=new RegExp("^(13[0-9]|14[5|7]|15[0|1|2|3|4|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\\d{8}$"),!1===o.test(this.upLoad.Telephone)&&a.push("请输入正确的电话号码")),s=this.io,e.next=6,t.syncPost("/api/roomApp/v1/CheckRoomAvailable",{start:s.data.StartDate,end:s.data.EndDate,roomId:s.data.RoomId,id:s.data.ID});case 6:return r=e.sent,r.success||i||a.push(r.msg),e.abrupt("return",a);case 9:case"end":return e.stop()}},e,this)}));function i(t){return e.apply(this,arguments)}return i}(),onSubmit:function(){var e=s(n.default.mark(function e(i,a){var o,s=this;return n.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return i&&(this.io.data[i.Field]=i.Value),this.io.shouldUpload.forEach(function(t){s.upLoad[t]=s.io[t]||s.io.data[t]}),e.next=4,this.formValidate(a);case 4:o=e.sent,o.length>0?t.showMessage(o[0]):t.post("/api/workflow/SubmitInstance",r({},this.upLoad),function(e){!0===e.success?t.showMessage("提交成功",1,"","success"):t.showMessage(e.msg,1)});case 6:case"end":return e.stop()}},e,this)}));function i(t,i){return e.apply(this,arguments)}return i}(),selectBuilding:function(t){t.detail.column;var e=t.detail.value;this.assistInfo.roomTemp=this.assistInfo.buildings[e].Rooms},selectRoom:function(t){var e=t.detail.value[1],i=this.assistInfo.roomTemp[e];this.io.data.RoomId=i.ID},selectTeacher:function(t){var e=this.assistInfo.teachers[t.detail.value];this.io.data.GuideTeacherId=e.ID,this.assistInfo.guideTeacherName=e.RealName},selectDateTime:function(t){t&&"w"!==t||!this.io.isMyStep||(this.showPicker=!this.showPicker)},confirmDateTime:function(t){this.io.data.StartDate=t.value[0],this.io.data.EndDate=t.value[1],this.selectDateTime()},foldUp:function(){this.displayTimeline=!this.displayTimeline}},data:function(){var t=new Date;return{now:t,io:{fieldAccess:{},data:{},submitBtns:[],shouldUpload:[],allSteps:[],isMyStep:!1,timelines:[],intstanceState:""},assistInfo:{buildings:[],rooms:[],teachers:[],roomTemp:[],roomIndex:[0,0],guideTeacherName:"请选择指导老师"},displayTimeline:!0,upLoad:[],roomDic:{},teacherDic:{},showPicker:!1,isStudent:!0}}};e.default=c}).call(this,i("543d")["default"])},"7a4b":function(t,e,i){"use strict";(function(t){i("965d"),i("921b");n(i("66fd"));var e=n(i("3bc7"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("543d")["createPage"])},a788:function(t,e,i){},db0e:function(t,e,i){"use strict";var n=i("a788"),a=i.n(n);a.a},e294:function(t,e,i){"use strict";i.r(e);var n=i("464f"),a=i.n(n);for(var o in n)"default"!==o&&function(t){i.d(e,t,function(){return n[t]})}(o);e["default"]=a.a},e6123:function(t,e,i){"use strict";var n,a=function(){var t=this,e=t.$createElement;t._self._c},o=[];i.d(e,"b",function(){return a}),i.d(e,"c",function(){return o}),i.d(e,"a",function(){return n})}},[["7a4b","common/runtime","common/vendor"]]]);